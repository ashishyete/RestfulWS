const express = require('express');
const { Pool } = require('pg');
const ExcelJS = require('exceljs');

const app = express();
const port = 3000;

const pool = new Pool({
  user: 'your_username',
  host: 'your_host',
  database: 'your_database',
  password: 'your_password',
  port: 5432,
});

app.get('/download-excel', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM your_function_name()');
    
    // Create a new workbook and add a worksheet
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('Sheet 1');

    // Add headers to the worksheet
    worksheet.addRow(['id', 'proj_nm', 'cat_typ', 'status', 'ex_Date']);

    // Add data to the worksheet
    result.rows.forEach((row) => {
      worksheet.addRow(row);
    });

    // Set the content type and disposition of the response
    res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
    res.setHeader('Content-Disposition', 'attachment; filename=your_excel_file.xlsx');

    // Write the workbook to the response
    await workbook.xlsx.write(res);

    // End the response
    res.end();
  } catch (error) {
    console.error('Error retrieving data from PostgreSQL:', error);
    res.status(500).send('Internal Server Error');
  }
});

app.listen(port, () => {
  console.log(`Server is running at http://localhost:${port}`);
});





Angular

import { Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Component({
  selector: 'app-your-component',
  template: `
    <button (click)="downloadExcel()">Download Excel</button>
  `,
})
export class YourComponent {
  constructor(private http: HttpClient) {}

  downloadExcel() {
    const apiUrl = 'http://localhost:3000/download-excel';

    // Make the HTTP request to the Node.js API endpoint
    this.http.get(apiUrl, { responseType: 'blob' }).subscribe((response) => {
      // Create a Blob from the response
      const blob = new Blob([response], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

      // Create a link element and click it to trigger the download
      const link = document.createElement('a');
      link.href = window.URL.createObjectURL(blob);
      link.download = 'your_excel_file.xlsx';
      link.click();
    });
  }
}
